webpackJsonp([0],{"/kWL":function(t,e,n){"use strict";function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(t,e){var n={};for(var o in t)e.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function y(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function p(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function h(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function b(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function P(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function g(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function S(t){var e=t.split(" ");if("play"===t)return{type:"play"};if("stop"===t)return{type:"stop"};if("next"===t)return{type:"next"};if(t.startsWith("player "))return{type:"ytPlayerCall",method:e[1],args:e.slice(2)};if(t.startsWith("random"))return{type:"addRandomToPlaylist"};var n=t.split(" ").reduce(function(t,e){return e.match(et)?t.concat(e):t},[]);return n.length?{type:"addToPlaylist",urls:n}:null}function O(t){return tt({},t,S(t.text),{stationId:t.channelId})}function v(t){return tt({},t,{commands:[],shuffledCommands:[],tags:Object(A.c)(Object(A.c)(t.tags,"radio-player"),"infinum-radio")})}function j(t){return t.urls?t.urls.map(function(e){return{url:e,person:t.person,isRealtime:t.isRealtime}}):[]}function w(t,e){var n=j(t);if(!t.isRealtime)return e.concat(n);for(var o=void 0,r=0;r<e.length;r++)if(!e[r].isRealtime){o=r-1;break}return e.slice(0,o+1).concat(n).concat(e.slice(o+1))}function C(){return new Promise(function(t,e){if(nt)t(YT);else{var n=document.createElement("script");n.src="https://www.youtube.com/player_api",n.onerror=e;var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(n,o),ot=t}})}function E(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function T(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var x=n("KM04"),N=n("xv7e"),R=n.n(N),Y=function(t){function e(){return o(this,t.apply(this,arguments))}return r(e,t),e.prototype.render=function(t){var e=t.radioStationsSlot,n=t.youtubePlayerSlot,o=t.radioPlaylistSlot,r=t.radioControlsSlot;return Object(x.h)("section",{class:R.a.player},Object(x.h)("div",{class:R.a.player_leftPane},e),Object(x.h)("div",{class:R.a.player_rightPane},Object(x.h)("div",{class:R.a.player_rightTopPane},n),Object(x.h)("div",{class:R.a.player_rightBottomPane},Object(x.h)("div",{class:R.a.player_playlistSlot},o),Object(x.h)("div",{class:R.a.player_controlsSlot},r))))},e}(x.Component),k=n("6whb"),M=n("Q1XY"),L=n.n(M),A=n("tyed"),V=function(t){function e(){return a(this,e),i(this,t.apply(this,arguments))}return s(e,t),e.prototype.onClick=function(){this.props.isCurrent||this.props.selectStation(this.props.station)},e.prototype.render=function(t){var e=t.station,n=t.isCurrent;return Object(x.h)("div",{class:L.a.radioStationItem+" "+(n?L.a.radioStationItem__isCurrent:""),onClick:Object(A.a)(this,"onClick")},Object(x.h)("div",{class:L.a.radioStationItem_name}," ",e.name," "),Object(x.h)("div",{class:L.a.radioStationItem_owner},"By: ",e.owner?e.owner.firstName:"God"),Object(x.h)("div",{class:L.a.radioStationItem_tags},e.tags.map(function(t){return Object(x.h)("div",{class:L.a.radioStationItem_tag}," ",t," ")})))},e}(x.Component),B=n("2s/V"),W=n.n(B),F=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},U=function(t){function e(){return c(this,e),u(this,t.apply(this,arguments))}return y(e,t),e.prototype.render=function(t){var e=t.stations,n=t.currentStation,o=l(t,["stations","currentStation"]);return Object(x.h)("div",{class:W.a.radioStationList},e.map(function(t){return Object(x.h)(V,F({station:t,isCurrent:t===n},o))}))},e}(x.Component),D=n("MVOb"),G=n.n(D),X=function(t){function e(){return p(this,e),f(this,t.apply(this,arguments))}return h(e,t),e.prototype.componentDidMount=function(){var t=this;this.props.getYtPlayerAPI().then(function(e){t.YT=e,t.initYtPlayer(e)})},e.prototype.componentWillUnmount=function(){this.ytPlayer.destroy()},e.prototype.initYtPlayer=function(t){var e=this;this.ytPlayer=new t.Player("youtube-player",{height:"390",width:"640",events:{onStateChange:function(){return e.onYtPlayerStateChange.apply(e,arguments)},onError:function(){return e.onYtPlayerError.apply(e,arguments)}}}),this.props.registerController({play:function(){return e.ytPlayer.playVideo()},stop:function(){return e.ytPlayer.stopVideo()},ytPlayerCall:function(t,n){var o;return(o=e.ytPlayer)[t].apply(o,n)},isPlaying:function(){return e.isPlaying},loadVideoByUrl:function(t){e.ytPlayer.loadVideoById(t.split("v=")[1]),e.isPlaying=!0}})},e.prototype.onYtPlayerStateChange=function(t){var e=t.data,n=this.YT;this.isPlaying=e===n.PlayerState.PLAYING||e===n.PlayerState.BUFFERING,e===n.PlayerState.ENDED&&this.props.onPlaybackEnd()},e.prototype.onYtPlayerError=function(){this.isPlaying=!1},e.prototype.render=function(){return Object(x.h)("div",{class:G.a.youtubePlayer},Object(x.h)("div",{id:"youtube-player",class:G.a.youtubePlayer_player}))},e}(x.Component),q=n("ilcq"),J=n.n(q),Q=function(t){function e(){return d(this,e),b(this,t.apply(this,arguments))}return P(e,t),e.prototype.render=function(t){var e=t.playlist,n=t.station,o=t.currentSong;return n?0===e.length?Object(x.h)("div",{class:J.a.radioPlaylist}," Playlist is empty! "):Object(x.h)("div",{class:J.a.radioPlaylist},Object(x.h)("div",{class:J.a.radioPlaylist_station},Object(x.h)("div",null," Likes: ",Object(x.h)("b",null," ",n.likeCount," ")," "),o&&Object(x.h)("div",null," Current song played by: ",o.person.firstName," ",o.person.lastName," ")),Object(x.h)("ol",{class:J.a.radioPlaylist_list},e.map(function(t){return Object(x.h)("li",{class:J.a.radioPlaylist_song+" "+(t.isRealtime?J.a.radioPlaylist_songRealtime:"")},Object(x.h)("span",{class:J.a.radioPlaylist_songPerson}," ",t.person.firstName," ",t.person.lastName," "),Object(x.h)("span",{class:J.a.radioPlaylist_songArrow}," ~> "),Object(x.h)("a",{href:t.url,target:"_blank",rel:"noopener",class:J.a.radioPlaylist_songLink}," ",t.url," "))}))):Object(x.h)("div",{class:J.a.radioPlaylist})},e}(x.Component),Z=n("M4JO"),z=n.n(Z),H=function(t){function e(){return _(this,e),m(this,t.apply(this,arguments))}return g(e,t),e.prototype.render=function(t){var e=t.isNextEnabled,n=t.onNext;return Object(x.h)("div",{class:z.a.radioControls},Object(x.h)("button",{type:"button",class:z.a.radioControls_button,disabled:!e,onClick:n},"Next"))},e}(x.Component),K=n("+UHd"),$=n("5Iuc"),tt=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},et=/http(.*)youtube(.*)v=/g,nt=!1,ot=void 0;"undefined"!=typeof window&&(window.onYouTubeIframeAPIReady=function(){nt=!0,ot(YT)});var rt=n("D9/9");n.d(e,"default",function(){return st});var at=Object(x.h)(k.a,{message:"Loading stations"}),it=Object(x.h)(k.a,{message:"Loading playlist"}),st=function(t){function e(){E(this,e);var n=I(this,t.call(this));return n.state={stations:[],playlist:[],currentSong:null,currentStation:null,isLoading:!0,isLoadingPlaylist:!1,connectionError:null},n}return T(e,t),e.prototype.componentWillMount=function(){var t=this;this.paPlayer=new K.a($.a),this.paPlayer.connect(function(e){return t.onProductiveMessage(e)}).then(function(){return t.paPlayer.fetchChannels()}).then(function(t){return t.filter(function(t){return t.tags.includes("radio-player")||t.tags.includes("infinum-radio")})}).then(function(t){return t.map(v)}).then(function(e){return t.setState({stations:e,isLoading:!1,connectionError:null})}).catch(function(e){if(e instanceof Error)throw e;t.setState({isLoading:!1,connectionError:e.toString()})})},e.prototype.componentWillUnmount=function(){clearInterval(this.playlistWatchTimer),this.paPlayer.disconnect()},e.prototype.onCommandAddToPlaylist=function(t){this.setState({playlist:w(t,this.state.playlist)}),this.state.currentSong&&this.state.currentSong.isRealtime||this.playNext()},e.prototype.onCommandAddRandomToPlaylist=function(t){var e=this;this.paPlayer.fetchMessagesForChannel(t.stationId).then(function(n){if(e.state.currentStation&&e.state.currentStation.id===t.stationId){var o=n.map(O).filter(function(t){return"addToPlaylist"===t.type}),r=Math.floor(Math.random()*o.length);r&&(e.setState({playlist:w(r,e.state.playlist)}),e.state.currentSong||e.playNext())}})},e.prototype.onProductiveMessage=function(t){Object(rt.a)(t);var e=O(t),n=this.state.currentStation;e.isRealtime=!0,n&&e.stationId===n.id&&("play"===e.type?this.youtubePlayer&&this.youtubePlayer.play():"stop"===e.type?this.youtubePlayer&&this.youtubePlayer.stop():"next"===e.type?this.youtubePlayer&&this.youtubePlayer.next():"ytPlayerCall"===e.type?this.youtubePlayer&&this.youtubePlayer.ytPlayerCall(e.method,e.args):"addToPlaylist"===e.type?this.onCommandAddToPlaylist(e):"addRandomToPlaylist"===e.type&&this.onCommandAddRandomToPlaylist(e))},e.prototype.onStationSelect=function(t){var e=this;this.state.currentStation!==t&&(clearInterval(this.playlistWatchTimer),this.youtubePlayer&&this.youtubePlayer.isPlaying()&&this.youtubePlayer.stop(),this.paPlayer.fetchSubscribersForChannel(t.id).then(function(n){t.likeCount=n,e.setState({currentStation:t})}),this.setState({currentStation:t,isLoadingPlaylist:!0}),this.paPlayer.fetchMessagesForChannel(t.id).then(function(n){if(e.state.currentStation===t){var o=n.map(O);t.commands=o.filter(function(t){return"addToPlaylist"===t.type});var r=t.commands.reduce(function(t,e){return t.concat(j(e))},[]);t.shuffledSongs=Object(A.b)(r),e.setState({playlist:t.shuffledSongs.splice(0,5),isLoadingPlaylist:!1}),e.playNext(),e.playlistWatchTimer=setInterval(function(){return e.addSongsForInfinitePlayback(t)},2e3)}}))},e.prototype.registerYoutubePlayer=function(t){this.youtubePlayer=t,this.state.currentSong&&this.youtubePlayer.loadVideoByUrl(this.state.currentSong.url)},e.prototype.resolveYtPlayerAPI=function(){return C()},e.prototype.onYoutubePlayerPlaybackEnd=function(){this.playNext()},e.prototype.addSongsForInfinitePlayback=function(t){var e=this.state,n=e.currentStation,o=e.playlist;if(!(n!==t||o.length>3)&&t.commands&&0!==t.commands.length&&t.shuffledSongs){if(0===t.shuffledSongs.length){var r=t.commands.reduce(function(t,e){return t.concat(j(e))},[]);t.shuffledSongs=Object(A.b)(r)}this.setState({playlist:this.state.playlist.concat(t.shuffledSongs.splice(0,5))}),this.state.currentSong||this.playNext()}},e.prototype.playNext=function(){var t=this.state.playlist;if(t&&0!==t.length){var e=t[0];this.setState({playlist:t.slice(1),currentSong:e}),this.youtubePlayer&&this.youtubePlayer.loadVideoByUrl(e.url)}},e.prototype.render=function(t,e){var n=e.isLoading,o=e.isLoadingPlaylist,r=e.stations,a=e.currentStation,i=e.playlist,s=e.currentSong;return Object(x.h)(Y,{radioStationsSlot:n?at:Object(x.h)(U,{stations:r,currentStation:a,selectStation:Object(A.a)(this,"onStationSelect")}),youtubePlayerSlot:Object(x.h)(X,{registerController:Object(A.a)(this,"registerYoutubePlayer"),getYtPlayerAPI:Object(A.a)(this,"resolveYtPlayerAPI"),onPlaybackEnd:Object(A.a)(this,"onYoutubePlayerPlaybackEnd")}),radioPlaylistSlot:o?it:Object(x.h)(Q,{station:a,playlist:i,currentSong:s}),radioControlsSlot:Object(x.h)(H,{isNextEnabled:i.length>0,onNext:Object(A.a)(this,"playNext")})})},e}(x.Component)},"2s/V":function(){},M4JO:function(t){t.exports={radioControls:"radioControls__5yEMN",radioControls_button:"radioControls_button__3Se2x"}},MVOb:function(t){t.exports={youtubePlayer_player:"youtubePlayer_player__1Lq1v"}},Q1XY:function(t){t.exports={radioStationItem:"radioStationItem__1VWwl",radioStationItem__isCurrent:"radioStationItem__isCurrent__1VUcG",radioStationItem_name:"radioStationItem_name__PvP4d",radioStationItem_owner:"radioStationItem_owner__2Fw-D",radioStationItem_tags:"radioStationItem_tags__z8P6B",radioStationItem_tag:"radioStationItem_tag__3orF_"}},ilcq:function(t){t.exports={radioPlaylist:"radioPlaylist__3FeXb",radioPlaylist_song:"radioPlaylist_song__3cTnE",radioPlaylist_songRealtime:"radioPlaylist_songRealtime__MSxru",radioPlaylist_songArrow:"radioPlaylist_songArrow__mjooA",radioPlaylist_songLink:"radioPlaylist_songLink__36bZ2",radioPlaylist_songPerson:"radioPlaylist_songPerson__3Vi-4"}},tyed:function(t,e){"use strict";function n(t,e){for(var n=arguments.length,o=Array(n>2?n-2:0),r=2;r<n;r++)o[r-2]=arguments[r];if(t._actions=t._actions||{},!t._actions[e]){if(!t[e])throw new Error('Method "'+e+'" not found on component');t._actions[e]=function(){for(var n=arguments.length,r=Array(n),a=0;a<n;a++)r[a]=arguments[a];return t[e].apply(t,o.concat(r))}}return t._actions[e]}function o(t){for(var e=t.slice(),n=e.length;n>0;){var o=Math.floor(Math.random()*n);n--;var r=e[n];e[n]=e[o],e[o]=r}return e}function r(t,e){var n=t.indexOf(e);if(n>=0){var o=t.slice();return o.splice(n,1),o}return t.slice()}e.a=n,e.b=o,e.c=r},xv7e:function(t){t.exports={player:"player__2Erj3",player_leftPane:"player_leftPane__1MYhh",player_rightPane:"player_rightPane__2kV6i",player_rightTopPane:"player_rightTopPane__sWTXo",player_rightBottomPane:"player_rightBottomPane__25G3B",player_playlistSlot:"player_playlistSlot__b5QeW",player_controlsSlot:"player_controlsSlot__3j3bZ"}}});
//# sourceMappingURL=route-radio-player.chunk.89bb2.js.map